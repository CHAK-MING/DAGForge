id = "trigger_rules_matrix"
name = "Trigger Rule Matrix"
description = "3 upstream sources produce: success + failed + skipped; plus blocker tasks to force upstream_failed."

[[tasks]]
id = "seed"
command = "echo 'seed'"

[[tasks]]
id = "u_success"
name = "Upstream Success"
command = "echo 'u_success'"
dependencies = ["seed"]

[[tasks]]
id = "u_failed"
name = "Upstream Failed"
command = "exit 1"
dependencies = ["seed"]
max_retries = 0

[[tasks]]
id = "branch_pick"
name = "Branch Pick (keep only b_kept)"
command = "echo '[\"b_kept\"]'"
dependencies = ["seed"]
is_branch = true

[[tasks]]
id = "b_kept"
name = "Branch Kept"
command = "echo 'kept'"
dependencies = ["branch_pick"]

[[tasks]]
id = "b_skipped"
name = "Branch Skipped (should be skipped)"
command = "echo 'should not run'"
dependencies = ["branch_pick"]

# 1) all_success
[[tasks]]
id = "all_success__expect_success"
command = "echo 'all_success ok'"
dependencies = ["u_success"]
trigger_rule = "all_success"

[[tasks]]
id = "all_success__expect_upstream_failed"
command = "echo 'should not run'"
dependencies = ["u_success", "u_failed"]
trigger_rule = "all_success"

# 2) all_failed
[[tasks]]
id = "all_failed__expect_success"
command = "echo 'all_failed ok'"
dependencies = ["u_failed"]
trigger_rule = "all_failed"

[[tasks]]
id = "all_failed__expect_upstream_failed"
command = "echo 'should not run'"
dependencies = ["u_success", "u_failed"]
trigger_rule = "all_failed"

# 3) all_done
[[tasks]]
id = "all_done__expect_success"
command = "echo 'all_done ok'"
dependencies = ["u_success", "u_failed", "b_skipped"]
trigger_rule = "all_done"

# 4) one_success
[[tasks]]
id = "one_success__expect_success"
command = "echo 'one_success ok'"
dependencies = ["u_success", "u_failed"]
trigger_rule = "one_success"

[[tasks]]
id = "one_success__expect_upstream_failed"
command = "echo 'should not run'"
dependencies = ["u_failed"]
trigger_rule = "one_success"

# 5) one_failed
[[tasks]]
id = "one_failed__expect_success"
command = "echo 'one_failed ok'"
dependencies = ["u_success", "u_failed"]
trigger_rule = "one_failed"

[[tasks]]
id = "one_failed__expect_upstream_failed"
command = "echo 'should not run'"
dependencies = ["u_success"]
trigger_rule = "one_failed"

# 6) one_done
[[tasks]]
id = "one_done__expect_success"
command = "echo 'one_done ok'"
dependencies = ["u_success", "b_skipped"]
trigger_rule = "one_done"

# 7) none_failed
[[tasks]]
id = "none_failed__expect_success"
command = "echo 'none_failed ok'"
dependencies = ["u_success", "b_skipped"]
trigger_rule = "none_failed"

[[tasks]]
id = "none_failed__expect_upstream_failed"
command = "echo 'should not run'"
dependencies = ["u_success", "u_failed"]
trigger_rule = "none_failed"

# 8) none_skipped
[[tasks]]
id = "none_skipped__expect_success"
command = "echo 'none_skipped ok'"
dependencies = ["u_success", "u_failed"]
trigger_rule = "none_skipped"

[[tasks]]
id = "none_skipped__expect_upstream_failed"
command = "echo 'should not run'"
dependencies = ["u_success", "b_skipped"]
trigger_rule = "none_skipped"

# 9) all_done_min_one_success
[[tasks]]
id = "all_done_min_one_success__expect_success"
command = "echo 'all_done_min_one_success ok'"
dependencies = ["u_success", "u_failed", "b_skipped"]
trigger_rule = "all_done_min_one_success"

[[tasks]]
id = "all_done_min_one_success__expect_upstream_failed"
command = "echo 'should not run'"
dependencies = ["u_failed", "b_skipped"]
trigger_rule = "all_done_min_one_success"

# 10) all_skipped
[[tasks]]
id = "all_skipped__expect_success"
command = "echo 'all_skipped ok'"
dependencies = ["b_skipped"]
trigger_rule = "all_skipped"

[[tasks]]
id = "all_skipped__expect_upstream_failed"
command = "echo 'should not run'"
dependencies = ["b_kept"]
trigger_rule = "all_skipped"

# 11) none_failed_min_one_success
[[tasks]]
id = "none_failed_min_one_success__expect_success"
command = "echo 'none_failed_min_one_success ok'"
dependencies = ["u_success", "b_skipped"]
trigger_rule = "none_failed_min_one_success"

[[tasks]]
id = "none_failed_min_one_success__expect_upstream_failed"
command = "echo 'should not run'"
dependencies = ["b_skipped"]
trigger_rule = "none_failed_min_one_success"

# 12) always
[[tasks]]
id = "always__expect_success"
command = "echo 'always ok'"
dependencies = ["u_success", "u_failed", "b_skipped"]
trigger_rule = "always"
